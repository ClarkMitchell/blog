<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Drag&amp;Drop reordering made easy</title>
    <meta name="description" content="When you need a quick drag&amp;drop that reorders your data in VueJS as well as elements in the DOM.">
    
    
    <link rel="preload" href="/assets/css/0.styles.d1fafc99.css" as="style"><link rel="preload" href="/assets/js/app.f0379f84.js" as="script"><link rel="preload" href="/assets/js/2.f113c167.js" as="script"><link rel="preload" href="/assets/js/18.407766eb.js" as="script"><link rel="prefetch" href="/assets/js/10.463c40b2.js"><link rel="prefetch" href="/assets/js/11.41347932.js"><link rel="prefetch" href="/assets/js/12.160cf6fa.js"><link rel="prefetch" href="/assets/js/13.869049d5.js"><link rel="prefetch" href="/assets/js/14.6ab5dbac.js"><link rel="prefetch" href="/assets/js/15.5b213614.js"><link rel="prefetch" href="/assets/js/16.9b9d25f1.js"><link rel="prefetch" href="/assets/js/17.53e9786c.js"><link rel="prefetch" href="/assets/js/19.ad818b5a.js"><link rel="prefetch" href="/assets/js/20.6a6cbda5.js"><link rel="prefetch" href="/assets/js/21.16473eda.js"><link rel="prefetch" href="/assets/js/22.17daa536.js"><link rel="prefetch" href="/assets/js/23.a3b585a7.js"><link rel="prefetch" href="/assets/js/24.693bd400.js"><link rel="prefetch" href="/assets/js/25.1cb8e654.js"><link rel="prefetch" href="/assets/js/3.e245ae37.js"><link rel="prefetch" href="/assets/js/4.32ef7c1a.js"><link rel="prefetch" href="/assets/js/5.1fabd509.js"><link rel="prefetch" href="/assets/js/6.3a66a41c.js"><link rel="prefetch" href="/assets/js/7.9038972a.js"><link rel="prefetch" href="/assets/js/8.0cd2f1f4.js"><link rel="prefetch" href="/assets/js/9.1449d7bd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d1fafc99.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <!----> </aside> <main class="page"> <div class="content default"><h1 id="drag-drop-reordering-made-easy"><a href="#drag-drop-reordering-made-easy" aria-hidden="true" class="header-anchor">#</a> Drag&amp;Drop reordering made easy</h1> <p>When you need a quick drag&amp;drop that reorders your data as well as elements in the DOM.</p> <GithubButton url="https://github.com/lorisleiva/vue-lab/tree/master/directives/dragdrop"></GithubButton> <h2 id="introduction"><a href="#introduction" aria-hidden="true" class="header-anchor">#</a> Introduction</h2> <p>Whilst the <a href="https://github.com/bevacqua/dragula" target="_blank" rel="noopener noreferrer">Dragula<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> library has mastered the art of quick and easy drag&amp;drop, it still has to be complete enough to appeal to a vast majority of projects. As a result it can be pretty cumbersome to implement a very simple drag&amp;drop reordering that keeps track of the new order within your data.</p> <p>VueJS has a few plugins that helps us encapsulate Dragula but they also carry a lot of complexity that most of my projects don't need.</p> <p>Therefore, I decided to create a little directive that I can copy/paste into components that need data reordering using drag&amp;drop.</p> <h2 id="the-expected-result"><a href="#the-expected-result" aria-hidden="true" class="header-anchor">#</a> The expected result</h2> <p>Let's say I have an array of <code>chapters</code> each containing an <code>order</code> property which is used to display them in the order requested by the user. What we want is a simple drag&amp;drop directive that reorders the DOM elements but also reorders the <code>chapters</code> array and edits the <code>order</code> properties accordingly. Let's start by writing the directive's usage as we wish it could be and we'll make it happen.</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">v-dragdrop</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>chapters<span class="token punctuation">&quot;</span></span> <span class="token attr-name">order</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>order<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> 
        <span class="token attr-name">v-for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>chapter in chapters<span class="token punctuation">&quot;</span></span> <span class="token attr-name">:key</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>chapter.id<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name">v-text</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">&quot;</span>chapter.title<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>With that first line, we tell our directive <code>v-dragdrop</code> to:</p> <ul><li>initialize Dragula on this <code>&lt;div&gt;</code> container</li> <li>that dragging and dropping will be updating our <code>chapters</code> array</li> <li>and we let it know where to find the order property in our items.</li></ul> <p>You can find a working example in the CodePen below.</p> <CodePen id="JpeBdr" title="Drag&amp;Drop made easy"></CodePen> <h2 id="the-dragdrop-directive"><a href="#the-dragdrop-directive" aria-hidden="true" class="header-anchor">#</a> The Dragdrop directive</h2> <p>Let's go through the steps of creating such a directive. I believe its important to understand how to create such a directive in order to be comfortable reusing it and modifying it in future projects.</p> <h3 id="step-1-initialize-and-destroy-dragula"><a href="#step-1-initialize-and-destroy-dragula" aria-hidden="true" class="header-anchor">#</a> Step 1. Initialize and destroy Dragula</h3> <p>We start by creating a <code>Dragdrop.js</code> file with the following code.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// resources/assets/js/directives/Dragdrop.js</span>

<span class="token comment">// npm install dragula -D</span>
<span class="token keyword">import</span> dragula <span class="token keyword">from</span> <span class="token string">'dragula'</span><span class="token punctuation">;</span>

<span class="token comment">// Make the drake instance available globally in order to destroy it later.</span>
<span class="token keyword">let</span> drake<span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token comment">// When the directive is first bound to the container.</span>
    <span class="token function">bind</span> <span class="token punctuation">(</span>container<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
        <span class="token comment">// Use dragula on the container.</span>
        drake <span class="token operator">=</span> <span class="token function">dragula</span><span class="token punctuation">(</span><span class="token punctuation">[</span>container<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token comment">// When the directive is unbound from the container.</span>
    <span class="token function">unbind</span> <span class="token punctuation">(</span>container<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
        <span class="token comment">// Kill the drake instance.</span>
        drake<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>This code makes sure that we bind dragula to the container and unbind it when we don't need it anymore. The problem with this implementation is that the <code>drake</code> global variable is shared with all components that use that directive. Therefore it only works with one drag&amp;drop list.</p> <h3 id="step-2-multiple-drag-drop-lists"><a href="#step-2-multiple-drag-drop-lists" aria-hidden="true" class="header-anchor">#</a> Step 2. Multiple drag&amp;drop lists</h3> <p>In order to overcome this problem, we need to introduce some kind of mapping between a drag&amp;drop container and its drake instance. Existing libraries tackle this problem by asking us to add an additional attribute with some unique key that will identify the drake instance. E.g. <code>bag=&quot;my_chapters&quot;</code> or <code>drake=&quot;my_chapters&quot;</code>. That way, if you give the same identifier to multiple containers, the library knows that they should share the same drake instance.</p> <p>However, in most use cases, I only need a new drake instance per drag&amp;drop list. Dragging &amp; dropping items from different lists together is out of scope when all you need is reordering a list.</p> <p>Therefore, every time we bind a new <code>dragdrop</code> directive to a container, we add a mapping between that container and the drake instance just so that we can destroy it when we're done with it.</p> <p>Since the container received in the <code>bind</code> function and the one received later in the <code>unbind</code> function have different object references, I instead bind the array of elements from VueJS to the drake instance.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// resources/assets/js/directives/Dragdrop.js</span>

<span class="token keyword">import</span> dragula <span class="token keyword">from</span> <span class="token string">'dragula'</span><span class="token punctuation">;</span>

<span class="token comment">// Map drake instances to their data structure globally in order to destroy them later.</span>
<span class="token comment">// An array at index `x` will have its drake instance at index `x` as well.</span>
<span class="token keyword">let</span> arrays <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> drakes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">{</span>
    <span class="token function">bind</span> <span class="token punctuation">(</span>container<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
        <span class="token keyword">let</span> drake <span class="token operator">=</span> <span class="token function">dragula</span><span class="token punctuation">(</span><span class="token punctuation">[</span>container<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// Map the items with the drake instance.</span>
        <span class="token function">addDrake</span><span class="token punctuation">(</span>items<span class="token punctuation">,</span> drake<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>

    <span class="token function">unbind</span> <span class="token punctuation">(</span>container<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    
        <span class="token comment">// Retrieve the drake instance and kill it.</span>
        <span class="token keyword">let</span> drake <span class="token operator">=</span> <span class="token function">getDrake</span><span class="token punctuation">(</span>binding<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>drake<span class="token punctuation">)</span> drake<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>For the sake of clarity, the above code uses two helper methods.</p> <ul><li>The <code>addDrake</code> method which registers a drake instance based on the reference of the given array.</li> <li>The <code>getDrake</code> method which retrieves a drake instance based on the reference of the given array.</li></ul> <p>So far, all we've done is dynamically bind and unbind Dragula to our containers. Whilst this will magically enable dragging and dropping DOM elements, it won't do anything about our <code>chapters</code> array in VueJS. We need to do this logic ourselves by adding some event listeners.</p> <h3 id="step-3-listen-to-drag-and-listen-to-drop"><a href="#step-3-listen-to-drag-and-listen-to-drop" aria-hidden="true" class="header-anchor">#</a> Step 3. Listen to drag and listen to drop</h3> <p>In the <code>bind</code> method of our directive we add some event listeners to our drake instance. The idea here is to keep track of the original index of a DOM element when it is being dragged and the final index of that same DOM element when it is being dropped. With those two indexes, we can mirror the DOM changes into our VueJs array.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">bind</span> <span class="token punctuation">(</span>container<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// Get the array of items to update.</span>
    <span class="token comment">// E.g. this would be `chapters` if `v-dragdrop=&quot;chapters&quot;`</span>
    <span class="token keyword">let</span> items <span class="token operator">=</span> binding<span class="token punctuation">.</span>value <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token comment">// Keep track of the last dragging index to do some reordering.</span>
    <span class="token keyword">let</span> dragIndex<span class="token punctuation">;</span>

    <span class="token keyword">let</span> drake <span class="token operator">=</span> <span class="token function">dragula</span><span class="token punctuation">(</span><span class="token punctuation">[</span>container<span class="token punctuation">]</span><span class="token punctuation">)</span>

        <span class="token comment">// When we drag an item, memorize its index.</span>
        <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'drag'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>el<span class="token punctuation">,</span> source<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            dragIndex <span class="token operator">=</span> <span class="token function">findDomIndex</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> el<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>

        <span class="token comment">// When we drop an item, reorder the array.</span>
        <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'drop'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>el<span class="token punctuation">,</span> target<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>

            <span class="token comment">// Move the dragged and dropped item from `dragIndex` to the new index.</span>
            <span class="token function">move</span><span class="token punctuation">(</span>items<span class="token punctuation">,</span> dragIndex<span class="token punctuation">,</span> <span class="token function">findDomIndex</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> el<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    <span class="token function">addDrake</span><span class="token punctuation">(</span>items<span class="token punctuation">,</span> drake<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The above code uses the following helper methods.</p> <ul><li>The <code>findDomIndex</code> method finds the index of a DOM element within a given DOM container.</li> <li>The <code>move</code> method moves an array item from one index to another. The given array is transformed, not returned.</li></ul> <h3 id="step-4-update-the-order-attribute"><a href="#step-4-update-the-order-attribute" aria-hidden="true" class="header-anchor">#</a> Step 4. Update the order attribute</h3> <p>So far when we drag&amp;drop, our DOM is being correctly reordered (by Dragula) and our VueJS array is being correctly reordered (by us). One last thing missing from our implementation is the ability to update the <code>order</code> property of our chapters to match the new array order.</p> <p>Implementing this is quite easy. We start a counter from 0 and go through the reordered array's items assigning and incrementing that counter.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">bind</span> <span class="token punctuation">(</span>container<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">)</span> <span class="token punctuation">{</span>

    <span class="token comment">// Get the `order` attribute if it exists.</span>
    <span class="token keyword">let</span> orderProperty <span class="token operator">=</span> vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>attrs <span class="token operator">?</span> vnode<span class="token punctuation">.</span>data<span class="token punctuation">.</span>attrs<span class="token punctuation">.</span>order <span class="token punctuation">:</span> undefined<span class="token punctuation">;</span>

    <span class="token keyword">let</span> items <span class="token operator">=</span> binding<span class="token punctuation">.</span>value <span class="token operator">||</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> dragIndex<span class="token punctuation">;</span>

    <span class="token keyword">let</span> drake <span class="token operator">=</span> <span class="token function">dragula</span><span class="token punctuation">(</span><span class="token punctuation">[</span>container<span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'drag'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>el<span class="token punctuation">,</span> source<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            dragIndex <span class="token operator">=</span> <span class="token function">findDomIndex</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> el<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">'drop'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>el<span class="token punctuation">,</span> target<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token function">move</span><span class="token punctuation">(</span>items<span class="token punctuation">,</span> dragIndex<span class="token punctuation">,</span> <span class="token function">findDomIndex</span><span class="token punctuation">(</span>target<span class="token punctuation">,</span> el<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            
            <span class="token comment">// If the container has a `order` attribute, use it to reorder them.</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>orderProperty<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">let</span> newOrder <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
                array<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span>items <span class="token operator">=&gt;</span> <span class="token punctuation">{</span> _<span class="token punctuation">.</span><span class="token keyword">set</span><span class="token punctuation">(</span>item<span class="token punctuation">,</span> orderProperty<span class="token punctuation">,</span> newOrder<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
    <span class="token function">addDrake</span><span class="token punctuation">(</span>items<span class="token punctuation">,</span> drake<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Note that I use lodash's <code>set</code> function here so we can provide a nested property via dot notation. In our chapter example, <code>order=&quot;order&quot;</code> will update <code>chapter.order</code> whilst <code>order=&quot;meta.order&quot;</code> will update <code>chapter.meta.order</code>.</p> <h2 id="conclusion"><a href="#conclusion" aria-hidden="true" class="header-anchor">#</a> Conclusion</h2> <p>And that's it! Next time you need to reorder some array by dragging and dropping just pull that code in a directive and use it wherever you like.</p> <p>If more control over dragula's options is needed (like adding a handle), one can easily use an <code>options</code> attribute (similarly to the <code>order</code> attribute) to register these options when instantiating Dragula.</p> <GithubButton url="https://github.com/lorisleiva/vue-lab/tree/master/directives/dragdrop"></GithubButton></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.f0379f84.js" defer></script><script src="/assets/js/2.f113c167.js" defer></script><script src="/assets/js/18.407766eb.js" defer></script>
  </body>
</html>
